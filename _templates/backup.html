<script>
	const canvas = document.querySelector("#preview");
	const context = canvas.getContext("2d");
	const video = document.querySelector("#video");
	video.setAttribute('autoplay', '');
  video.setAttribute('muted', '');
  video.setAttribute('playsinline', '');
  //   const socket = io({transports: ['websocket']});
  const socket = io();

  socket.on('session_id', (session_id) => {
	  console.log("session_id", session_id)
  })

  socket.on('disconnect', () => {
	  console.log('disconnected')
	  location.reload()
  })
	canvas.width = 900;
  canvas.height = 700;

  context.width = canvas.width;
		  context.height = canvas.height;

	const loadCamera = (stream) => {
	  try {
		video.srcObject = stream;
	  } catch (err) {
		video.src = URL.createObjectURL(stream);
	  }
	  console.log("camera connected");
	};

	const Draw = (video, context) => {
	  context.drawImage(video, 0, 0, context.width, context.height);
	  socket.emit("stream",canvas.toDataURL('image/jpeg', 0.4));
	};

	navigator.getUserMedia =
	  navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msgGetUserMedia;

	if (navigator.getUserMedia) {
	  navigator.mediaDevices.getUserMedia(
		{
		  video: {
		facingMode: 'user',
		height: {ideal:1920},
		width: {ideal: 1920},
	  },
		  audio: false,
		},
		loadCamera,
		() => {"Camera loading failed"}
	  );
	}

	setInterval(function () {
	  Draw(video, context);
	}, 50);
  </script>